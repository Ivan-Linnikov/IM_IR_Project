<template>
    <div class="bg-[#f1f1f1] bg-cover min-h-screen font-raleway p-10">
        <!-- Title and Search Bar -->
        <div class="flex flex-column items-center w-full">
            <!-- Title on the very left of the page -->
            <NuxtLink to="/" class="pl-0">
                <h1 class="font-oswald text-4xl text-[#111111] font-normal">Find Beauty</h1>
            </NuxtLink>
            <!-- Centered Search Bar -->
            <div class="flex-grow flex justify-center">
                <SearchBar class="w-full max-w-6xl" />
            </div>
        </div>


        <!-- Filter Section -->
        <div class="flex justify-center mt-8">
            <div class="flex items-end justify-center w-full max-w-6xl space-x-4">

                <!-- City Select -->
                <div class="w-1/3 relative">
                    <label for="city" class="block text-sm font-medium text-[#111111] mb-2">City</label>
                    <div class="flex items-center w-full bg-white rounded-full shadow-lg p-3 space-x-2">
                        <input type="text" v-model="cityInput" @input="filterCities" @focus="showCityOptions = true"
                            @blur="hideOptions" id="city" placeholder="Type or select a city"
                            class="outline-none focus:outline-none focus:ring-0 focus:bg-transparent bg-white text-[#111111] placeholder-[#111111] flex-1 min-w-0" />

                    </div>
                    <ul v-if="showCityOptions && filteredCities.length"
                        class="absolute z-10 bg-white shadow-lg rounded-lg mt-2 max-h-40 overflow-y-auto w-full">
                        <li v-for="(city, index) in filteredCities" :key="index" @mousedown="selectCity(city)"
                            class="p-4 text-[#111111] hover:bg-black hover:text-white cursor-pointer">
                            {{ city }}
                        </li>
                    </ul>
                </div>

                <!-- Day of the Week Select -->
                <div class="w-1/5">
                    <label for="day" class="block text-sm font-medium text-[#111111] mb-2">Day</label>
                    <div class="flex items-center w-full bg-white rounded-full shadow-lg p-3">
                        <select id="day" class="outline-none bg-white text-[#111111] flex-1 min-w-0 appearance-none">
                            <option value="">Select a day</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                            <option value="Sunday">Sunday</option>
                        </select>
                    </div>
                </div>

                <!-- Time Input -->
                <div class="w-1/5">
                    <label for="time" class="block text-sm font-medium text-[#111111] mb-2">Time</label>
                    <div class="flex items-center w-full bg-white rounded-full shadow-lg p-3 cursor-pointer"
                        @click="openTimePicker">
                        <input ref="timeInput" type="time" id="time"
                            class="outline-none focus:outline-none focus:ring-0 bg-white text-[#111111] flex-1 min-w-0 cursor-pointer" />
                    </div>
                </div>

                <!-- Filter Button -->
                <div class="flex items-end">
                    <button @click="applyFilters"
                        class="bg-black text-white px-6 py-3 rounded-full transition-all duration-300 hover:border hover:border-black hover:bg-white hover:text-[#111111]">
                        Filter
                    </button>
                </div>

            </div>
        </div>
        <div v-if="!store.isLoading && !store.queryErrorMessage" class="grid grid-cols-2 gap-10 mt-20 items-start">
            <Card v-for="item in store.results" :key="item.docno" :item="item" @mark-relevant="markAsRelevant"
                @mark-not-relevant="markAsNotRelevant" />
        </div>
        <div v-if="!store.isLoading && store.filterErrorMessage" class="mt-20 text-center text-[#111111]">
            <h2 class="text-2xl font-bold">No results found</h2>
            <p>Try adjusting your filters. </p>
            <p class="text-gray-500">The search should be within Switzerland.</p>
        </div>
        <div v-if="!store.isLoading && store.queryErrorMessage" class="mt-20 text-center text-[#111111]">
            <h2 class="text-2xl font-bold">{{ store.queryErrorMessage }}</h2>
            <p>Try adjusting your search criteria or using different keywords.</p>
        </div>
    </div>
</template>

<script lang="ts" setup>
import { ref } from 'vue';
import { useSearchStore } from '~/stores/searchStore';
import SearchBar from '~/components/SearchBar.vue';

const store = useSearchStore();

// City input logic
const cityInput: Ref<string> = ref('');
const filteredCities: Ref<string[]> = ref([]);
const showCityOptions: Ref<boolean> = ref(false);

const cityOptions: string[] = [
    "Aadorf",
    "Aarau",
    "Aarau Rohr",
    "Aarburg",
    "Aarwangen",
    "Abtwil SG",
    "Adelboden",
    "Adlikon b",
    "Adliswil",
    "Aegerten",
    "Aesch",
    "Aesch LU",
    "Affoltern am Albis",
    "Agno",
    "Aigle",
    "Algetshausen",
    "Alle",
    "Allschwil",
    "Alpnach Dorf",
    "Altb",
    "Altdorf",
    "Altdorf UR",
    "Altendorf",
    "Altst",
    "Amlikon-Bissegg",
    "Amriswil",
    "Andeer",
    "Anglikon",
    "Appenzell",
    "Apples",
    "Aproz",
    "Arbon",
    "Arch",
    "Arlesheim",
    "Arni AG",
    "Ascona",
    "Attalens",
    "Attiswil",
    "Au SG",
    "Aubonne",
    "Auenstein",
    "Aumont",
    "Auw",
    "Avegno",
    "Aven",
    "Avenches",
    "Avry-sur-Matran",
    "Avully",
    "Azmoos",
    "B",
    "Baar",
    "Bachenb",
    "Bad Ragaz",
    "Bad Zurzach",
    "Baden",
    "Balerna",
    "Balsthal",
    "Balzers",
    "Bannwil",
    "Basel",
    "Bassecourt",
    "Bassersdorf",
    "Bauma",
    "Belfaux",
    "Bellach",
    "Bellinzona",
    "Belp",
    "Belprahon",
    "Benken SG",
    "Bercher",
    "Berg",
    "Berikon",
    "Beringen",
    "Berlens",
    "Bern",
    "Berneck",
    "Berom",
    "Bevaix",
    "Bex",
    "Bi",
    "Biasca",
    "Biberist",
    "Biel",
    "Biel Bienne",
    "Biel- Bienne",
    "Biel-Bienne",
    "Bilten",
    "Binningen",
    "Bioggio",
    "Birmensdorf",
    "Birmensdorf ZH",
    "Birr",
    "Birsfelden",
    "Bischofszell",
    "Blignoud",
    "Blonay",
    "Blumenstein",
    "Boll",
    "Bolligen",
    "Boncourt",
    "Bonfol",
    "Bonvillars",
    "Bossonnens",
    "Boswil",
    "Bottighofen",
    "Bottmingen",
    "Boudry",
    "Bouveret",
    "Br",
    "Braunau",
    "Breganzona",
    "Breitenbach",
    "Bremgarten AG",
    "Brig",
    "Brissago",
    "Bronschhofen",
    "Brugg AG",
    "Brunnen",
    "Bubendorf",
    "Bubikon",
    "Buchrain",
    "Buchs AG",
    "Buchs SG",
    "Buchs ZH",
    "Bulle",
    "Buochs",
    "Bure",
    "Burgdorf",
    "Burgistein",
    "Bussigny",
    "Buttes",
    "Buttikon SZ",
    "Buttisholz",
    "Buttwil",
    "Buus",
    "Cadenazzo",
    "Camorino",
    "Campascio",
    "Campione d'Italia",
    "Carouge GE",
    "Castione",
    "Celerina",
    "Cernier",
    "Ch",
    "Chailly-Montreux",
    "Chalais",
    "Cham",
    "Champ",
    "Chavornay",
    "Cheseaux-sur-Lausanne",
    "Chesi",
    "Chevenez",
    "Chexbres",
    "Chez-le-Bart",
    "Chiasso",
    "Chippis",
    "Chur",
    "Clarens",
    "Claro",
    "Cointrin",
    "Coldrerio",
    "Collombey",
    "Colombier",
    "Conthey",
    "Coppet",
    "Corcelles-pr",
    "Corin-de-la-Cr",
    "Corminboeuf",
    "Cornaux",
    "Corserey",
    "Cossonay-Ville",
    "Cottens",
    "Courgenay",
    "Courroux",
    "Court",
    "Crans-Montana",
    "Crissier",
    "Cugnasco",
    "Cugy",
    "Cugy VD",
    "D",
    "Dagmersellen",
    "Dallenwil",
    "Damphreux",
    "Davos Dorf",
    "Davos Platz",
    "Deitingen",
    "Del",
    "Derendingen",
    "Develier",
    "Dielsdorf",
    "Diepoldsau",
    "Dietikon",
    "Dietlikon",
    "Disentis",
    "Domat",
    "Domdidier",
    "Dongio",
    "Donneloye",
    "Dornach",
    "Dottikon",
    "Duillier",
    "Dussnang",
    "Ebikon",
    "Ebnat-Kappel",
    "Echallens",
    "Echichens",
    "Ecublens VD",
    "Ecuvillens",
    "Effretikon",
    "Egerkingen",
    "Egg b",
    "Eglisau",
    "Egliswil",
    "Egnach",
    "Ehrendingen",
    "Einsiedeln",
    "Elgg",
    "Embrach",
    "Emmen",
    "Emmenbr",
    "Engelburg",
    "Englisberg",
    "Ennenda",
    "Ennetaach",
    "Ennetb",
    "Ennetbaden",
    "Entlebuch",
    "Epalinges",
    "Erde",
    "Erlach",
    "Erlen",
    "Erlenbach ZH",
    "Erlenbach im Simmental",
    "Erlinsbach",
    "Erlinsbach SO",
    "Ermatingen",
    "Ermensee",
    "Ersigen",
    "Eschen",
    "Eschenbach LU",
    "Eschenbach SG",
    "Eschlikon",
    "Escholzmatt",
    "Estavayer-le-Lac",
    "Ettenhausen",
    "Ettingen",
    "F",
    "Farvagny-le-Grand",
    "Fehraltorf",
    "Fehren",
    "Felben-Wellhausen",
    "Felsberg",
    "Feuerthalen",
    "Fiesch",
    "Fislisbach",
    "Fl",
    "Flawil",
    "Fleurier",
    "Flims Dorf",
    "Flims Waldhaus",
    "Flums",
    "Fontainemelon",
    "Forel",
    "Fraubrunnen",
    "Frauenfeld",
    "Freienbach",
    "Freienstein",
    "Frenkendorf",
    "Fribourg",
    "Frick",
    "Frutigen",
    "Fully",
    "G",
    "Gais",
    "Gampelen",
    "Gamprin",
    "Gams",
    "Gattikon",
    "Gebenstorf",
    "Gelterkinden",
    "Geneva",
    "Genolier",
    "Gerlafingen",
    "Gerlikon",
    "Gerolfingen",
    "Giffers",
    "Giornico",
    "Gipf-Oberfrick",
    "Giswil",
    "Giubiasco",
    "Givisiez",
    "Gland",
    "Glarus",
    "Glattbrugg",
    "Glattpark",
    "Gletterens",
    "Glis",
    "Gockhausen",
    "Goldach",
    "Goldau",
    "Goldiwil",
    "Gordola",
    "Gossau SG",
    "Gossau ZH",
    "Gr",
    "Grabs",
    "Grancia",
    "Grand-Lancy",
    "Granges-pr",
    "Greifensee",
    "Grellingen",
    "Grenchen",
    "Grimisuat",
    "Grindel",
    "Grindelwald",
    "Grossaffoltern",
    "Gudo",
    "Guntershausen b",
    "Gurmels",
    "Gurtnellen",
    "Gwatt",
    "H",
    "Hagenbuch ZH",
    "Hagenwil b",
    "Hasle LU",
    "Hasle b",
    "Hauptwil",
    "Hausen AG",
    "Hausen am Albis",
    "Heerbrugg",
    "Heiden",
    "Heimberg",
    "Heimenhausen",
    "Hendschiken",
    "Henggart",
    "Hergiswil",
    "Herisau",
    "Herrliberg",
    "Hettlingen",
    "Hindelbank",
    "Hinterkappelen",
    "Hinwil",
    "Hirzel",
    "Hitzkirch",
    "Hochdorf",
    "Hofstetten b",
    "Holzh",
    "Hombrechtikon",
    "Horgen",
    "Horw",
    "Hunzenschwil",
    "Huttwil",
    "Igis",
    "Ilanz",
    "Illnau",
    "Interlaken",
    "Ipsach",
    "Jaun",
    "Jegenstorf",
    "Jenins",
    "Jona",
    "K",
    "Kaiseraugst",
    "Kaisten",
    "Kaltbrunn",
    "Kandersteg",
    "Kefikon TG",
    "Kerns",
    "Kerzers",
    "Kesswil",
    "Kestenholz",
    "Kiesen",
    "Kilchberg ZH",
    "Kirchberg BE",
    "Kirchberg SG",
    "Kirchdorf AG",
    "Kirchlindach",
    "Kleinandelfingen",
    "Kleinb",
    "Kleind",
    "Klosters",
    "Kloten",
    "Kollbrunn",
    "Konolfingen",
    "Kreuzlingen",
    "Kriens",
    "Krummenau",
    "L",
    "La Ch",
    "La Chaux-de-Fonds",
    "La Croix",
    "La Neuveville",
    "La Sagne",
    "La Sarraz",
    "La Tour-de-Peilz",
    "Laax GR",
    "Lachen SZ",
    "Landquart",
    "Langendorf",
    "Langenthal",
    "Langnau am Albis",
    "Langnau im Emmental",
    "Langwiesen",
    "Laufen",
    "Laupen BE",
    "Lausanne",
    "Lausen",
    "Le Brassus",
    "Le Grand-Saconnex",
    "Le Landeron",
    "Le Locle",
    "Le Mont-sur-Lausanne",
    "Le Mouret",
    "Le Noirmont",
    "Le S",
    "Lengnau BE",
    "Lenzburg",
    "Lenzerheide",
    "Les Acacias",
    "Les Breuleux",
    "Leukerbad",
    "Leytron",
    "Lichtensteig",
    "Liebefeld",
    "Liebistorf",
    "Lieli LU",
    "Liestal",
    "Linden",
    "Locarno",
    "Lohn-Ammannsegg",
    "Losone",
    "Lotzwil",
    "Lucens",
    "Lucerne",
    "Lufingen",
    "Lugano",
    "Liechtenstein",
    "Lugnez",
    "Lumbrein",
    "Lupfig",
    "Lupsingen",
    "Lurtigen",
    "Lutry",
    "Lutzenberg",
    "Lyss",
    "M",
    "Madiswil",
    "Magden",
    "Maggia",
    "Maienfeld",
    "Maisprach",
    "Malans GR",
    "Malleray",
    "Malters",
    "Malvaglia",
    "Marbach SG",
    "Marin-Epagnier",
    "Marly",
    "Martigny",
    "Martigny-Croix",
    "Massagno",
    "Matten b",
    "Matzendorf",
    "Matzingen",
    "Maur",
    "Mauren",
    "Mauren FL",
    "Meggen",
    "Meierskappel",
    "Meilen",
    "Meinisberg",
    "Meisterschwanden",
    "Melano",
    "Melide",
    "Mellingen",
    "Mels",
    "Mendrisio",
    "Menziken",
    "Menzingen",
    "Merenschwand",
    "Mettlen",
    "Mettmenstetten",
    "Meyrin",
    "Mi",
    "Minusio",
    "Mirchel",
    "Mitl",
    "Mittelh",
    "Mollis",
    "Monte Carasso",
    "Montet",
    "Monthey",
    "Montignez",
    "Montlingen",
    "Montreux",
    "Moosseedorf",
    "Morbio Inferiore",
    "Morbio Superiore",
    "Morges",
    "Moudon",
    "Moutier",
    "Muhen",
    "Muralto",
    "Muraz",
    "Muri AG",
    "Muri b",
    "Murten",
    "Muttenz",
    "N",
    "Naters",
    "Necker",
    "Neerach",
    "Neftenbach",
    "Netstal",
    "Neuch",
    "Neuendorf",
    "Neuenegg",
    "Neuenhof",
    "Neuenkirch",
    "Neuhaus SG",
    "Neuhausen am Rheinfall",
    "Neukirch",
    "Neyruz",
    "Nidau",
    "Niederbipp",
    "Niederdorf",
    "Niederg",
    "Niederglatt ZH",
    "Niederhasli",
    "Niederhelfenschwil",
    "Niederrohrdorf",
    "Niederurnen",
    "Niederuzwil",
    "Niederwangen b",
    "Niederweningen",
    "Niederwil AG",
    "Nierlet-les-Bois",
    "Nottwil",
    "Novazzano",
    "Nussbaumen AG",
    "Nusshof",
    "Nyon",
    "Oberaach",
    "Oberb",
    "Oberbipp",
    "Oberbuchsiten",
    "Oberburg",
    "Oberdorf",
    "Oberegg",
    "Oberentfelden",
    "Obergerlafingen",
    "Oberglatt ZH",
    "Oberiberg",
    "Oberkirch LU",
    "Oberkulm",
    "Oberried am Brienzersee",
    "Oberrieden",
    "Oberriet SG",
    "Oberrohrdorf",
    "Oberschrot",
    "Oberurnen",
    "Oberuzwil",
    "Oberwil BL",
    "Obfelden",
    "Oensingen",
    "Oeschenbach",
    "Oftringen",
    "Ollon VD",
    "Olten",
    "Onex",
    "Opfikon",
    "Orbe",
    "Ormalingen",
    "Oron-la-Ville",
    "Orvin",
    "Ostermundigen",
    "Otelfingen",
    "Paradiso",
    "Payerne",
    "Penthalaz",
    "Perly",
    "Peseux",
    "Petit-Lancy",
    "Pf",
    "Pfaffnau",
    "Plan-les-Ouates",
    "Pollegio",
    "Ponte Capriasca",
    "Porrentruy",
    "Porsel",
    "Poschiavo",
    "Pratteln",
    "Pregassona",
    "Prilly",
    "Pully",
    "R",
    "Rafz",
    "Ramosch",
    "Rapperswil BE",
    "Rapperswil SG",
    "Raron",
    "Rebstein",
    "Recherswil",
    "Rechthalten",
    "Reconvilier",
    "Regensdorf",
    "Reichenbach im Kandertal",
    "Reichenburg",
    "Reiden",
    "Reinach",
    "Reinach AG",
    "Reitnau",
    "Renan",
    "Renens",
    "Renens VD",
    "Rheineck",
    "Rheinfelden",
    "Richterswil",
    "Rickenbach LU",
    "Rickenbach Sulz",
    "Rickenbach ZH",
    "Riddes",
    "Riehen",
    "Riffenmatt",
    "Riggisberg",
    "Riva San Vitale",
    "Rivera",
    "Roggwil",
    "Roggwil BE",
    "Rohrbach",
    "Rolle",
    "Romanel-sur-Lausanne",
    "Romanshorn",
    "Rombach",
    "Romont",
    "Root",
    "Rorbas",
    "Rorschach",
    "Rorschacherberg",
    "Rossemaison",
    "Rossens FR",
    "Rothrist",
    "Rotkreuz",
    "Rudolfstetten",
    "Ruggell",
    "Rupperswil",
    "Ruswil",
    "S",
    "S-chanf",
    "Sachseln",
    "Safenwil",
    "Safnern",
    "Sagogn",
    "Saillon",
    "Saint-Aubin",
    "Saint-Blaise",
    "Saland",
    "Salez",
    "Salgesch",
    "Samedan",
    "Samstagern",
    "Sant",
    "Sargans",
    "Sarmenstorf",
    "Sarnen",
    "Savagnier",
    "Savi",
    "Savigny",
    "Savognin",
    "Sax",
    "Sch",
    "Schaan",
    "Schaanwald",
    "Schachen LU",
    "Schaffhausen",
    "Schangnau",
    "Schattdorf",
    "Schellenberg",
    "Schlatt TG",
    "Schlieren",
    "Schmerikon",
    "Schmitten",
    "Schnaus",
    "Schnottwil",
    "Schupfart",
    "Schw",
    "Schwarzenbach SG",
    "Schwarzenberg LU",
    "Schwarzenburg",
    "Schwarzsee",
    "Schwerzenbach",
    "Schwyz",
    "Scuol",
    "Seedorf BE",
    "Seewen",
    "Seftigen",
    "Selzach",
    "Sementina",
    "Sempach",
    "Semsales",
    "Sent",
    "Seon",
    "Seseglio",
    "Seuzach",
    "Sevelen",
    "Siebnen",
    "Sierre",
    "Siggenthal Station",
    "Signau",
    "Silvaplana",
    "Sion",
    "Sirnach",
    "Siselen BE",
    "Sissach",
    "Sisseln AG",
    "Siviriez",
    "Solduno",
    "Solothurn",
    "Sonceboz-Sombeval",
    "Sonvilier",
    "Speicher",
    "Spiegel b",
    "Spiez",
    "Spreitenbach",
    "St",
    "St-Cergue",
    "St-Imier",
    "St-L",
    "St-Maurice",
    "St-Prex",
    "St-Ursanne",
    "Stabio",
    "Stadel b",
    "Stalden VS",
    "Stans",
    "Stansstad",
    "Ste-Croix",
    "Steckborn",
    "Steffisburg",
    "Steg VS",
    "Stein AR",
    "Stein am Rhein",
    "Steinen",
    "Steinhausen",
    "Steinmaur",
    "Stetten AG",
    "Stettfurt",
    "Stettlen",
    "Strengelbach",
    "Suchy",
    "Suhr",
    "Sulgen",
    "Sulz AG",
    "Sumiswald",
    "Sursee",
    "Susten",
    "Sutz",
    "T",
    "Tafers",
    "Tagelswangen",
    "Tegerfelden",
    "Tenero",
    "Teufen AR",
    "Th",
    "Thal",
    "Thalwil",
    "Thayngen",
    "Theilingen",
    "Therwil",
    "Thun",
    "Thusis",
    "Toffen",
    "Tramelan",
    "Triesen",
    "Triesenberg",
    "Trimbach",
    "Trin",
    "Troistorrents",
    "Trun",
    "Truttikon",
    "Tuggen",
    "Turbenthal",
    "Turgi",
    "Udligenswil",
    "Uerikon",
    "Uerkheim",
    "Uetendorf",
    "Uetikon am See",
    "Uffikon",
    "Unter",
    "Unterentfelden",
    "Unteriberg",
    "Unterramsern",
    "Untersiggenthal",
    "Untervaz",
    "Ursy",
    "Urtenen-Sch",
    "Uster",
    "Uttwil",
    "Utzenstorf",
    "Uzwil",
    "V",
    "Vacallo",
    "Vaduz",
    "Val-d",
    "Vaulruz",
    "Vella",
    "Verbier",
    "Vernier",
    "Verscio",
    "Versoix",
    "Vessy",
    "Vevey",
    "Veyras",
    "Vezia",
    "Vich",
    "Viganello",
    "Villars-Ste-Croix",
    "Villars-le-Terroir",
    "Villars-sur-Gl",
    "Villars-sur-Ollon",
    "Villmergen",
    "Villnachern",
    "Vilters",
    "Vinelz",
    "Visp",
    "Visperterminen",
    "Vitznau",
    "Volketswil",
    "Voll",
    "Vouvry",
    "Vuiteboeuf",
    "W",
    "Wabern",
    "Wahlendorf",
    "Walchwil",
    "Wald ZH",
    "Waldkirch",
    "Walenstadt",
    "Wallisellen",
    "Waltenschwil",
    "Wangen b",
    "Watt",
    "Wattenwil",
    "Wattwil",
    "Weggis",
    "Weiach",
    "Weinfelden",
    "Werdenberg",
    "Wettingen",
    "Wettswil",
    "Wetzikon ZH",
    "Wetzikon-Pf",
    "Wichtrach",
    "Widnau",
    "Wiedlisbach",
    "Wiggen",
    "Wigoltingen",
    "Wil SG",
    "Wilen b",
    "Willisau",
    "Winden",
    "Windisch",
    "Winterthur",
    "Winznau",
    "Wittenbach",
    "Wittnau",
    "Wohlen AG",
    "Wohlen b",
    "Wolfenschiessen",
    "Wolfhausen",
    "Wolfwil",
    "Wolhusen",
    "Wollerau",
    "Worb",
    "Worben",
    "Yens",
    "Yverdon-les-Bains",
    "Yvonand",
    "Z",
    "Zeihen",
    "Zell LU",
    "Zermatt",
    "Zofingen",
    "Zollbr",
    "Zollikofen",
    "Zollikon",
    "Zuchwil",
    "Zug",
    "Zumholz",
    "Zurich",
    "Zuzwil SG",
    "Zweisimmen"
];


function filterCities(): void {
    const input = cityInput.value.toLowerCase();
    filteredCities.value = cityOptions.filter(city =>
        city.toLowerCase().includes(input)
    );
}

function selectCity(city: string): void {
    cityInput.value = city;
    showCityOptions.value = false;
}

function hideOptions(): void {
    setTimeout(() => {
        showCityOptions.value = false;
    }, 150);
}

const timeInput: Ref<HTMLInputElement | null> = ref(null);

function openTimePicker(): void {
    if (timeInput.value) {
        timeInput.value.showPicker();
    }
}

async function applyFilters(): Promise<void> {
    const filters = {
        city: cityInput.value,
        day: (document.getElementById('day') as HTMLSelectElement)?.value || '',
        time: timeInput.value?.value || '',
    };

    console.log('Filters applied with:', filters);

    try {
        store.isLoading = true;
        store.filterErrorMessage = '';

        const response = await $fetch('http://localhost:8000/result', {
            method: 'POST',
            body: filters,
        });

        store.results = response as any[];
        console.log('Results:', store.results);

        // Check if the results are empty
        if (store.results.length === 0) {
            store.filterErrorMessage = 'No results found.';
        }

    } catch (error) {
        store.filterErrorMessage = 'An error occurred while applying filters.';
    } finally {
        store.isLoading = false;

        cityInput.value = '';
        (document.getElementById('day') as HTMLSelectElement).value = '';
        if (timeInput.value) {
            timeInput.value.value = '';
        }
    }
}


function markAsRelevant(docno: string): void {
    const index = store.results.findIndex(item => item.docno === docno);
    if (index !== -1) {
        const [item] = store.results.splice(index, 1); // Remove the item
        store.results.unshift(item); // Add it to the beginning
    }
}

function markAsNotRelevant(docno: string): void {
    store.results = store.results.filter(item => item.docno !== docno); // Remove the item
}
</script>
